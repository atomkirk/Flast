<!DOCTYPE html>
<!-- saved from url=(0048)http://phrogz.net/tmp/canvas_zoom_to_cursor.html -->
<html lang="en" data-ember-extension="1">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Zooming Test</title>
    <style type="text/css" media="screen">
      body { background:#eee; margin:1em; text-align:center; }
      canvas { display:block; margin:1em auto; background:#fff; border:1px solid #ccc }
    </style>
    <script src="flast.js"></script>
  </head>
  <body>
    <!-- <canvas width="800" height="600"></canvas> -->
    <canvas style="width: 100%; height: 100%;"></canvas>
    <!-- <canvas style="width: 800px; height: 600px;"></canvas> -->
    <!-- <canvas width="800" height="600"></canvas> -->

    <script type="text/javascript" charset="utf-8">
      window.onload = () => {
        var canvas = document.getElementsByTagName('canvas')[0];
        window.editor = new Flast(canvas, {
          width: 7727,
          height: 10000,
          getTileUrl: function(zoom, x, y) {
            return `https://s3-us-west-2.amazonaws.com/useredline-api/development/tiles/a4d450cf8bdf8916a860658a/tile_${zoom}_${x}x${y}.jpg`;
          },
          tools: [
            Flast.ARROW,
            Flast.LINE,
            Flast.CIRCLE,
            Flast.RECTANGLE
          ],
          annotations: [{
            shapes: [{
              kind: 'circle',
              geometry: {
                center: {
                  x: 500,
                  y: 700
                },
                radius: 200
              }
            }]
          }],
          callbacks: {
            didStartAnnotation: function(annotation) {
              document.querySelector("#js-done-button").style.display = '';
            },
            didFinishAnnotation: function(annotation) {
              window.lastAnnotation = annotation;
              document.querySelector("#js-done-button").style.display = 'none';
            },
            didSelectAnnotation: function(annotation) {
              window.lastAnnotation = annotation;
              document.querySelector("#js-done-button").style.display = '';
            },
            didBeginDrawingShape: function(shape) {
              // console.log('didBeginDrawingShape');
            },
            didCancelDrawingShape: function(shape) {
              // console.log('didCancelDrawingShape');
            },
            didFinishDrawingShape: function(shape) {
              // console.log('didFinishDrawingShape');
            },
            didUpdateTransform: function(transform) {
              // console.log(transform);
            }
          }
        });
      };

      function selectArrowTool(e) {
        editor.setTool('arrow');
      }

      function selectLineTool(e) {
        editor.setTool('line');
      }

      function selectCircleTool(e) {
        editor.setTool('circle');
      }

      function selectRectangleTool(e) {
        editor.setTool('rectangle');
      }

      function center(e) {
        if (window.lastAnnotation) {
          editor.selectAnnotation(window.lastAnnotation);
          let rect = editor.boundingRectFor(window.lastAnnotation)
          editor.zoomToRect({
            x: rect.x - 200,
            y: rect.y - 200,
            width: rect.width + 400,
            height: rect.height + 400
          });
        }
      }

      function done(e) {
        editor.completeAnnotation();
      }
    </script>
    <button onclick="selectArrowTool()">arrow</button>
    <button onclick="selectLineTool()">line</button>
    <button onclick="selectCircleTool()">circle</button>
    <button onclick="selectRectangleTool()">rectangle</button>
    <button onclick="center()">center</button>
    <button id="js-done-button" style="display: none;" onclick="done()">done</button>
    <div style="border: 1px black solid; width: 200px; height: 200px;"></div>
  </body>
</html>
