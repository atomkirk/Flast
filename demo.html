<!DOCTYPE html>
<!-- saved from url=(0048)http://phrogz.net/tmp/canvas_zoom_to_cursor.html -->
<html lang="en" data-ember-extension="1">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Zooming Test</title>
    <style type="text/css" media="screen">
      html,
      body {
        background: #eee;
        width: 100%;
        height: 100%;
        margin: 0;
      }

      /* Style page content - use this if you want to push the page content to the right when you open the side navigation */
      #main {
        position: relative;
        transition: margin-left 0.5s;
        padding: 20px;
        text-align: center;
      }

      canvas {
        background: #fff;
        border: 1px solid #ccc;
        width: 100%;
        height: 100%;
        bottom: 0;
        left: 0;
        top: 0;
        right: 0;
      }

      /* The side navigation menu */
      .sidenav {
        height: 100%; /* 100% Full-height */
        width: 250px; /* 0 width - change this with JavaScript */
        position: fixed; /* Stay in place */
        z-index: 1; /* Stay on top */
        top: 0; /* Stay at the top */
        left: 0;
        background-color: #111; /* Black*/
        overflow-x: hidden; /* Disable horizontal scroll */
        padding-top: 60px; /* Place content 60px from the top */
        transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
      }

      /* The navigation menu links */
      .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.3s;
      }

      /* When you mouse over the navigation links, change their color */
      .sidenav a:hover {
        color: #f1f1f1;
      }

      /* Position and style the close button (top right corner) */
      .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
      }

      /* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
      @media screen and (max-height: 450px) {
        .sidenav {
          padding-top: 15px;
        }
        .sidenav a {
          font-size: 18px;
        }
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="flast.js"></script>
  </head>
  <body>
    <div id="mySidenav" class="sidenav">
      <a href="?token=0fb94435-677b-4766-9050-45cc9f83c8b8&page=0&width=9996&height=12936">Letter PDF</a>
      <a href="?token=0fb94435-677b-4766-9050-45cc9f83c8b8&page=1&width=19998&height=15453">Landscape letter</a>
      <a href="?token=0fb94435-677b-4766-9050-45cc9f83c8b8&page=2&width=19980&height=13320">Civil drawing</a>
      <a href="?token=516ef3f6-cf8a-45e3-b69f-b3768f77ce56&page=1&width=19966&height=30456">Tall DWG</a>
    </div>
    <div id="main">
      <!-- <canvas width="800" height="600"></canvas> -->
      <!-- <canvas style="width: 100%; height: 100%;"></canvas> -->
      <canvas></canvas>
      <!-- <canvas width="800" height="600"></canvas> -->

      <button onclick="selectArrowTool()">arrow</button>
      <button onclick="selectLineTool()">line</button>
      <button onclick="selectCircleTool()">circle</button>
      <button onclick="selectRectangleTool()">rectangle</button>
      <button onclick="center()">center</button>
      <button id="js-done-button" style="display: none;" onclick="done()">done</button>
    </div>

    <script type="text/javascript" charset="utf-8">
      function parseQuery(queryString) {
        let query = {}
        let pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&')
        for (let i = 0; i < pairs.length; i++) {
          let pair = pairs[i].split('=')
          query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '')
        }
        return query
      }

      window.onload = () => {
        let query = parseQuery(window.location.search)
        let canvas = document.getElementsByTagName('canvas')[0]
        window.editor = new Flast(canvas, {
          width: query.width,
          height: query.height,
          getTileUrl: function(zoom, x, y) {
            return `https://flast-redline-dvp-tiles.s3-us-west-2.amazonaws.com/${query.token}/page_${query.page}/zoom_${zoom}/tile_${x}x${y}.png`
          },
          tools: [Flast.ARROW, Flast.LINE, Flast.CIRCLE, Flast.RECTANGLE],
          annotations: [
            {
              shapes: [
                {
                  kind: 'circle',
                  geometry: {
                    center: {
                      x: 500,
                      y: 700,
                    },
                    radius: 200,
                  },
                },
              ],
            },
          ],
          callbacks: {
            didStartAnnotation: function(annotation) {
              document.querySelector('#js-done-button').style.display = ''
            },
            didFinishAnnotation: function(annotation) {
              window.lastAnnotation = annotation
              document.querySelector('#js-done-button').style.display = 'none'
            },
            didSelectAnnotation: function(annotation) {
              window.lastAnnotation = annotation
              document.querySelector('#js-done-button').style.display = ''
            },
            didBeginDrawingShape: function(shape) {
              // console.log('didBeginDrawingShape');
            },
            didCancelDrawingShape: function(shape) {
              // console.log('didCancelDrawingShape');
            },
            didFinishDrawingShape: function(shape) {
              // console.log('didFinishDrawingShape');
            },
            didUpdateTransform: function(transform) {
              // console.log(transform);
            },
          },
        })
      }

      $(window).on('resize', () => {
        console.log('here')
        $('canvas').width($('#main').width())
        $('canvas').height($('#main').height())
      })

      function selectArrowTool(e) {
        editor.setTool('arrow')
      }

      function selectLineTool(e) {
        editor.setTool('line')
      }

      function selectCircleTool(e) {
        editor.setTool('circle')
      }

      function selectRectangleTool(e) {
        editor.setTool('rectangle')
      }

      function center(e) {
        if (window.lastAnnotation) {
          editor.selectAnnotation(window.lastAnnotation)
          console.log(window.lastAnnotation)
          let rect = editor.boundingRectFor(window.lastAnnotation)
          console.log(rect)
          editor.zoomToRect({
            x: rect.x - 200,
            y: rect.y - 200,
            width: rect.width + 400,
            height: rect.height + 400,
          })
        }
      }

      function done(e) {
        editor.completeAnnotation()
      }
    </script>
  </body>
</html>
