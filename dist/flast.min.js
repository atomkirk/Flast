"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _typeof(t){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=_unsupportedIterableToArray(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,r=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(o)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function getSqDist(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function getSqSegDist(t,e,i){var n=e.x,a=e.y,r=i.x-n,o=i.y-a;if(0!==r||0!==o){var s=((t.x-n)*r+(t.y-a)*o)/(r*r+o*o);s>1?(n=i.x,a=i.y):s>0&&(n+=r*s,a+=o*s)}return r=t.x-n,o=t.y-a,r*r+o*o}function simplifyRadialDist(t,e){for(var i,n=t[0],a=[n],r=1,o=t.length;r<o;r++)i=t[r],getSqDist(i,n)>e&&(a.push(i),n=i);return n!==i&&a.push(i),a}function simplifyDPStep(t,e,i,n,a){for(var r,o=n,s=e+1;s<i;s++){var h=getSqSegDist(t[s],t[e],t[i]);h>o&&(r=s,o=h)}o>n&&(r-e>1&&simplifyDPStep(t,e,r,n,a),a.push(t[r]),i-r>1&&simplifyDPStep(t,r,i,n,a))}function simplifyDouglasPeucker(t,e){var i=t.length-1,n=[t[0]];return simplifyDPStep(t,0,i,e,n),n.push(t[i]),n}function simplify(t,e,i){if(t.length<=2)return t;var n=void 0!==e?e*e:1;return t=i?t:simplifyRadialDist(t,n),t=simplifyDouglasPeucker(t,n)}var _hitMargin,_lineWidth,Flast=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t),this._canvas=e,this._once(e),this._init(i),this.redraw()}return _createClass(t,[{key:"reinit",value:function(t){var e=Object.assign(this.originalOptions,t);this._init(e),this.redraw()}},{key:"destroy",value:function(){window.removeEventListener("keyup",this._keyUpHandler)}},{key:"_init",value:function(e){this.originalOptions=e,this.maxZoom=e.maxZoom||4,this.zoomSpeed=e.zoomSpeed||1.01,this.getTileUrl=e.getTileUrl||function(t,e,i){return"https://s3-us-west-2.amazonaws.com/useredline-api/development/tiles/168d136e60b14850d7a671e8/tile_".concat(t,"_").concat(e,"x").concat(i,".jpg")},this.tools=e.tools||[t.ARROW,t.LINE,t.CIRCLE,t.RECTANGLE],this.annotations=e.annotations||[],this.callbacks=e.callbacks||{},this._selectedAnnotation=null,this._drawingAnnotation=null,this._currentShape=null,this._maxScale=e.maxScale||2,this._authorColor=e.authorColor,this._state={mouse:"up",tool:"none",dragging:!1,drawing:!1,enabled:!0,calibration:e.calibration},this._contentSize={width:e.width||624*Math.pow(2,this.maxZoom),height:e.height||416*Math.pow(2,this.maxZoom)},this.setTileSize({width:this._contentSize.width/Math.pow(2,this.maxZoom),height:this._contentSize.height/Math.pow(2,this.maxZoom)}),this._transform.e=this._transform.f=0,this._transform.a=this._transform.d=this._minScale,this._clampToBounds(),this._applyTransform(this._transform)}},{key:"_once",value:function(t){this.canvasWidth=t.clientWidth,this.canvasHeight=t.clientHeight;var e=t.getContext("2d");this._ctx=e,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._transform=this._svg.createSVGMatrix(),this._addEventListeners(),this._configureCanvas()}},{key:"resize",value:function(){var t=this._canvas;this.canvasWidth=t.clientWidth,this.canvasHeight=t.clientHeight,this._transform.e=this._transform.f=0,this._transform.a=this._transform.d=this._minScale,this.setTileSize(this.tileSize),this._configureCanvas(),this._clampToBounds(),this._applyTransform(this._transform),this.redraw()}},{key:"_pixelRatio",value:function(){return window.devicePixelRatio}},{key:"setTool",value:function(t){if(!t)return this._state.tool="none",void(this.callbacks.didSelectTool&&this.callbacks.didSelectTool(null));this.tools.find(function(e){return e.name===t})?(this._state.tool=t,this.callbacks.didSelectTool&&this.callbacks.didSelectTool(this._state.tool),this.redraw()):console.error("Flask: That tool is not defined.")}},{key:"setEnabled",value:function(t){this._state.enabled=t}},{key:"setTileSize",value:function(t){this.tileSize=t,this._tileCache={};var e=this.canvasWidth/this._contentSize.width,i=this.canvasHeight/this._contentSize.height;this._minScale=Math.min(e,i)}},{key:"redraw",value:function(){var t=this,e=this._transformedPoint(0,0),i=this._transformedPoint(this.canvasWidth,this.canvasHeight),n={x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y};this._ctx.clearRect(n.x,n.y,n.width,n.height),this._ctx.fillStyle="#cccccc",this._ctx.fillRect(-1e9,-1e9,2e9,2e9);for(var a=Math.log(this._minScale)/Math.LN2,r=Math.log(this._maxScale)/Math.LN2,o=Math.log(this._transform.a)/Math.LN2,s=(o-a)/(r-a),h=Math.max(Math.ceil(s*this.maxZoom),1),l=Math.pow(2,h),c=this._contentSize.width/l*this._pixelRatio(),u=this._contentSize.height/l*this._pixelRatio(),d=0;d<l;d++)for(var f=0;f<l;f++){var y={x:d*c,y:f*u,width:c,height:u};if(this._intersectRect(n,y)){var _=this._tileImage(h,d,f);if(_.complete&&0!==_.naturalHeight)this._ctx.drawImage(_,y.x,y.y,y.width,y.height);else for(var m=h-1;m>0;){var p=Math.floor(d/Math.pow(2,h)*Math.pow(2,m)),v=Math.floor(f/Math.pow(2,h)*Math.pow(2,m)),g=this._tileImage(m,p,v);if(g.complete&&0!==g.naturalHeight){var x=Math.pow(2,h)/Math.pow(2,m),w=d-x*p,b=f-x*v,k=g.width/x,S=g.height/x,T=Math.floor(w*k),A=Math.floor(b*S);this._ctx.drawImage(g,T,A,k,S,y.x,y.y,y.width,y.height);break}m-=1}}}var M,R=this._drawingAnnotation||{shapes:[]},C=_createForOfIteratorHelper(this.annotations.concat(R));try{for(C.s();!(M=C.n()).done;){var I=M.value;this._selectedAnnotation&&!this.callbacks.compareAnnotations(I,this._selectedAnnotation)||this._drawingAnnotation&&!this.callbacks.compareAnnotations(I,this._drawingAnnotation)?this._ctx.globalAlpha=.2:this._ctx.globalAlpha=1;var E=I.shapes;I===R&&(E=E.concat(this._currentShape||[]));var L,D=_createForOfIteratorHelper(E);try{for(D.s();!(L=D.n()).done;)!function(){var e=L.value,i=t.tools.find(function(t){return t.name===e.kind});t._ctx.fillStyle=I.color||t._authorColor||"#FF0000",t._ctx.strokeStyle=I.color||t._authorColor||"#FF0000",t._ctx.lineWidth=_lineWidth,i.drawInContext(t._ctx,i.scaleGeometry(e.geometry,t._pixelRatio()))}()}catch(t){D.e(t)}finally{D.f()}}}catch(t){C.e(t)}finally{C.f()}this._ctx.globalAlpha=1}},{key:"setAnnotations",value:function(t){this.annotations=t,this.redraw()}},{key:"completeAnnotation",value:function(){var t=this,e=function(){t._drawingAnnotation=null,t._state.tool="none",t.callbacks.didSelectTool&&t.callbacks.didSelectTool(null),t.redraw()};this._drawingAnnotation&&this.callbacks.didFinishAnnotation?this.callbacks.didFinishAnnotation(this._drawingAnnotation,e):e()}},{key:"cancelAnnotation",value:function(){this._drawingAnnotation&&this.callbacks.didCancelAnnotation&&this.callbacks.didCancelAnnotation(this._drawingAnnotation),this._drawingAnnotation=null,this.callbacks.didSelectTool&&"none"!==this._state.tool&&this.callbacks.didSelectTool(null),this._state.tool="none",this.redraw()}},{key:"cancelShape",value:function(){this._currentShape&&this.callbacks.didCancelDrawingShape&&this.callbacks.didCancelDrawingShape(this._currentShape),this._state.drawing=!1,this._currentShape=null,this.redraw()}},{key:"selectAnnotation",value:function(t){this._selectedAnnotation=t,this.callbacks.didSelectAnnotation&&this.callbacks.didSelectAnnotation(t),this.redraw()}},{key:"boundingRectFor",value:function(t){var e,i=this,n=1/0,a=0,r=1/0,o=0,s=_createForOfIteratorHelper(t.shapes);try{for(s.s();!(e=s.n()).done;)!function(){var t=e.value,s=i.tools.find(function(e){return e.name===t.kind}),h=s.boundingRect(s.scaleGeometry(t.geometry,i._pixelRatio()));n=Math.min(n,h.x),a=Math.max(a,h.x+h.width),r=Math.min(r,h.y),o=Math.max(o,h.y+h.height)}()}catch(t){s.e(t)}finally{s.f()}return{x:n,y:r,width:a-n,height:o-r}}},{key:"zoomToRect",value:function(e){var i=this.canvasWidth*this._pixelRatio(),n=this.canvasHeight*this._pixelRatio(),a=i/e.width,r=n/e.height,o=Math.min(a,r);o=t.clamp(o,this._minScale,this._maxScale),this._transform.a=this._transform.d=o,this._transform.e=-e.x*o,this._transform.f=-e.y*o,this._clampToBounds(),this._updateTransform()}},{key:"setTransform",value:function(t){this._transform=t,this._clampToBounds(),this._updateTransform()}},{key:"getTool",value:function(t){return this.tools.find(function(e){return e.name===t})}},{key:"getDimensions",value:function(t){var e=this,i=t.kind,n=t.geometry,a=this.tools.find(function(t){return t.name===i});return this._state.calibration&&a&&a.dimensions?a.dimensions(n).map(function(t){var i=t.key,n=t.value;return"area"===i?{key:i,value:n*Math.pow(e._state.calibration,2)}:{key:i,value:n*e._state.calibration}}):null}},{key:"_addEventListeners",value:function(){this._canvas.addEventListener("mousedown",this._mouseDown.bind(this),!1),this._canvas.addEventListener("mousemove",this._mouseMove.bind(this),!1),this._canvas.addEventListener("mouseleave",this._mouseLeave.bind(this),!1),this._canvas.addEventListener("mouseup",this._mouseUp.bind(this),!1),this._canvas.addEventListener("DOMMouseScroll",this._updateZoom.bind(this),!1),this._canvas.addEventListener("mousewheel",this._updateZoom.bind(this),!1),this._keyUpHandler=this._keyUp.bind(this),window.addEventListener("keyup",this._keyUpHandler,!1)}},{key:"_configureCanvas",value:function(){var t=this._pixelRatio();this._canvas.style.width=this.canvasWidth+"px",this._canvas.style.height=this.canvasHeight+"px",this._canvas.setAttribute("width",this.canvasWidth*t),this._canvas.setAttribute("height",this.canvasHeight*t),this._ctx.scale(t,t),_hitMargin=60*this._pixelRatio()*2,_lineWidth=10*this._pixelRatio()*2}},{key:"_updateZoom",value:function(e){var i=e.wheelDelta?e.wheelDelta/40:e.detail?-e.detail:0;if(i){var n=this._eventPoint(e);if(this._currentShape){var a=this._currentTool();this._currentShape.geometry=a.updateGeometry(this._currentShape.geometry,{x:n.x/this._pixelRatio(),y:n.y/this._pixelRatio()})}var r=Math.pow(this.zoomSpeed,i),o=t.clamp(this._transform.a*r,this._minScale,this._maxScale);this._transform=this._transform.translate(n.x,n.y),this._transform.a=this._transform.d=o,this._transform=this._transform.translate(-n.x,-n.y),this._clampToBounds(),this._updateTransform()}return e.preventDefault()&&!1}},{key:"_mouseDown",value:function(t){this._state.mouse="down",document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",this._dragStart=this._eventPoint(t)}},{key:"_mouseUp",value:function(e){var i=this;this._state.mouse="up";var n=this._eventPoint(e);if(this._state.dragging)this._state.dragging=!1,this.callbacks.didEndDragging&&this.callbacks.didEndDragging();else if(!this._state.drawing&&"none"!==this._state.tool&&this._state.enabled){this._state.drawing=!0;var a=this._currentTool(),r={x:n.x/this._pixelRatio(),y:n.y/this._pixelRatio()};this._currentShape={kind:a.name,geometry:a.startGeometry(r)},this.callbacks.didBeginDrawingShape&&this.callbacks.didBeginDrawingShape(this._currentShape)}else if(this._state.drawing){var o=this._currentTool(),s={x:n.x/this._pixelRatio(),y:n.y/this._pixelRatio()};if(o.shouldAddSegment&&o.shouldAddSegment(this._currentShape.geometry,s,e))this._currentShape.geometry=o.addSegment(this._currentShape.geometry,s),this.callbacks.didUpdateDrawingShape&&this.callbacks.didUpdateDrawingShape({shape:this._currentShape,event:e}),this.redraw();else{if(this._state.drawing=!1,this._drawingAnnotation||(this._drawingAnnotation={shapes:[]},this.callbacks.didStartAnnotation&&this.callbacks.didStartAnnotation(this._drawingAnnotation)),o.finalGeometry&&(this._currentShape.geometry=o.finalGeometry(this._currentShape.geometry)),this._drawingAnnotation.shapes.push(this._currentShape),this.callbacks.didFinishDrawingShape&&this.callbacks.didFinishDrawingShape(this._currentShape),"calibrator"===this._state.tool){var h=t.parseUnits(this.callbacks.promptForCalibration());if(h){var l=h.value,c=this._currentShape.geometry,u=c.p1,d=c.p2,f=t._distance(d,u);this._state.calibration=l/f,this.callbacks.didCalibrate&&this.callbacks.didCalibrate(this._state.calibration)}this.cancelAnnotation()}this._currentShape=null,this.redraw()}}else if(this._state.enabled){var y,_=_createForOfIteratorHelper(this.annotations);try{for(_.s();!(y=_.n()).done;){var m,p=y.value,v=_createForOfIteratorHelper(p.shapes);try{for(v.s();!(m=v.n()).done;){var g=function(){var t=m.value,e=i.tools.find(function(e){return e.name===t.kind});if(e.hitTest(e.scaleGeometry(t.geometry,i._pixelRatio()),n))return i.callbacks.didSelectAnnotation&&i.callbacks.didSelectAnnotation(p),{v:void 0}}();if("object"===_typeof(g))return g.v}}catch(t){v.e(t)}finally{v.f()}}}catch(t){_.e(t)}finally{_.f()}}}},{key:"_mouseMove",value:function(e){var i=this,n=this._eventPoint(e);if("down"===this._state.mouse&&!this._state.dragging){return void(t._distance(n,this._dragStart)>10/this._transform.a&&(this._state.dragging=!0,this.callbacks.didBeginDragging&&this.callbacks.didBeginDragging()))}if(this._state.dragging){var a=n.x-this._dragStart.x,r=n.y-this._dragStart.y;return this._transform=this._transform.translate(a,r),this._clampToBounds(),void this._updateTransform()}if(this._state.drawing){var o=this._currentTool();this._currentShape.geometry=o.updateGeometry(this._currentShape.geometry,{x:n.x/this._pixelRatio(),y:n.y/this._pixelRatio()}),this.callbacks.didUpdateDrawingShape&&this.callbacks.didUpdateDrawingShape({shape:this._currentShape,event:e}),this.redraw()}if("up"===this._state.mouse&&!this._state.drawing&&this._state.enabled){var s,h=this._eventPoint(e),l={},c=_createForOfIteratorHelper(this.annotations);try{for(c.s();!(s=c.n()).done;){var u,d=s.value,f=_createForOfIteratorHelper(d.shapes);try{for(f.s();!(u=f.n()).done;)!function(){var t=u.value,n=i.tools.find(function(e){return e.name===t.kind});n.hitTest(n.scaleGeometry(t.geometry,i._pixelRatio()),h)&&(l={annotation:d,shape:t,event:e})}()}catch(t){f.e(t)}finally{f.f()}}}catch(t){c.e(t)}finally{c.f()}this.callbacks.mouseOverAnnotation&&this.callbacks.mouseOverAnnotation(l)}}},{key:"_mouseLeave",value:function(t){this._state.dragging&&(this._state.dragging=!1,this._state.mouse="up")}},{key:"_keyUp",value:function(t){if(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName))return!0;if(!this._state.enabled)return!1;if(this._state.drawing&&27===t.which)return this.cancelShape(),t.preventDefault(),t.stopPropagation(),!0;if(13===t.which&&this._drawingAnnotation)this.completeAnnotation();else if(this._state.enabled){var e,i=_createForOfIteratorHelper(this.tools);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(t.which===n.keyCode)return this._state.tool=n.name,this.callbacks.didSelectTool&&this.callbacks.didSelectTool(this._state.tool),t.preventDefault(),t.stopPropagation(),!0}}catch(t){i.e(t)}finally{i.f()}}return!0}},{key:"_transformedPoint",value:function(t,e){var i=this._svg.createSVGPoint();return i.x=t*this._pixelRatio(),i.y=e*this._pixelRatio(),i.matrixTransform(this._transform.inverse())}},{key:"_applyTransform",value:function(t){this._ctx.setTransform(t.a,t.b,t.c,t.d,t.e,t.f),_hitMargin=1/this._transform.a*10*this._pixelRatio()}},{key:"_updateTransform",value:function(){this._applyTransform(this._transform),this.redraw(),this.callbacks.didUpdateTransform&&this.callbacks.didUpdateTransform(this._transform)}},{key:"_clampToBounds",value:function(){var e=this._contentSize.width*this._transform.a*this._pixelRatio(),i=this._contentSize.height*this._transform.d*this._pixelRatio(),n=this.canvasWidth*this._pixelRatio(),a=this.canvasHeight*this._pixelRatio(),r=e,o=i;e/i<n/a?r=n*(i/a):o=a*(e/n);var s=(r-e)/2,h=-r+n+s;this._transform.e=t.clamp(this._transform.e,h,s);var l=(o-i)/2,c=-o+a+l;this._transform.f=t.clamp(this._transform.f,c,l)}},{key:"_eventPoint",value:function(t){var e=t.offsetX||t.pageX-this._canvas.offsetLeft,i=t.offsetY||t.pageY-this._canvas.offsetTop;return this._transformedPoint(e,i)}},{key:"_tileImage",value:function(t,e,i){var n=this,a=this.getTileUrl(t,e,i),r=this._tileCache[a];return r||(r=new Image,r.src=a,r.onload=function(){n.redraw()},this._tileCache[a]=r),r}},{key:"_intersectRect",value:function(t,e){return t={left:t.x,right:t.x+t.width,top:t.y,bottom:t.y+t.height},e={left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height},!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}},{key:"_currentTool",value:function(){var t=this;return this.tools.find(function(e){return e.name===t._state.tool})}}],[{key:"clamp",value:function(t,e,i){return Math.max(Math.min(t,i),e)}},{key:"_distance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}},{key:"_onLine",value:function(t,e){return this._pointDistToLine(e,t)<_hitMargin}},{key:"_pointDistToLine",value:function(t,e){var i=t.x,n=t.y,a=e.p1.x,r=e.p1.y,o=e.p2.x,s=e.p2.y,h=i-a,l=n-r,c=o-a,u=s-r,d=h*c+l*u,f=c*c+u*u,y=-1;0!=f&&(y=d/f);var _,m;y<0?(_=a,m=r):y>1?(_=o,m=s):(_=a+y*c,m=r+y*u);var p=i-_,v=n-m;return Math.sqrt(p*p+v*v)}},{key:"parseUnits",value:function(t){var e=[{variants:["feet","foot","ft","'"],multiplier:1},{variants:["inches","inch","in",'"'],multiplier:1/12},{variants:["meters","meter","metre","m"],multiplier:3.281},{variants:["miles","mile","mi"],multiplier:5280},{variants:["yards","yard","y"],multiplier:3}];if(!t)return null;if(t.match(/^[\d.]+$/))return{value:1*t,units:"feet"};var i={value:0,unit:"feet"},n=e.reduce(function(t,e){var i=e.variants;return t.concat(i)},[]).join("|");return t.replace(new RegExp("(([\\d.]{1,})( |)(".concat(n,"]))"),"g"),function(t,n,a,r,o){var s=e.find(function(t){return t.variants.includes(o)});i.value+=a*s.multiplier}),{value:i.value,units:"feet"}}},{key:"LINE",get:function(){return{name:"line",keyCode:76,startGeometry:function(t){return{p1:{x:t.x,y:t.y},p2:{x:t.x,y:t.y}}},updateGeometry:function(t,e){return t.p2={x:e.x,y:e.y},t},boundingRect:function(t){var e=Math.min(t.p1.x,t.p2.x),i=Math.max(t.p1.x,t.p2.x),n=Math.min(t.p1.y,t.p2.y);return{x:e,y:n,width:i-e,height:Math.max(t.p1.y,t.p2.y)-n}},drawInContext:function(t,e){var i=e.p1,n=e.p2;t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(n.x,n.y),t.stroke()},hitTest:function(e,i){return t._onLine(e,i)},scaleGeometry:function(t,e){return{p1:{x:t.p1.x*e,y:t.p1.y*e},p2:{x:t.p2.x*e,y:t.p2.y*e}}},dimensions:function(e){var i=e.p1,n=e.p2;return[{key:"length",value:t._distance(n,i)}]},hint:function(t){return t?"Click to draw the second point.":"Click to draw the first point of a new line."}}}},{key:"CALIBRATOR",get:function(){return{name:"calibrator",keyCode:188,startGeometry:t.LINE.startGeometry,updateGeometry:t.LINE.updateGeometry,boundingRect:t.LINE.boundingRect,drawInContext:t.LINE.drawInContext,hitTest:t.LINE.hitTest,scaleGeometry:t.LINE.scaleGeometry,hint:function(t){return t?"Click the right side of the scale bar.":"Click the left side of the scale bar."}}}},{key:"ARROW",get:function(){return{name:"arrow",keyCode:65,startGeometry:t.LINE.startGeometry,updateGeometry:t.LINE.updateGeometry,boundingRect:t.LINE.boundingRect,drawInContext:function(t,e){var i=e.p1,n=e.p2,a=6*_lineWidth;t.beginPath(),t.moveTo(i.x,i.y);var r={dx:n.x-i.x,dy:n.y-i.y},o=Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2)),s=(o-a)/o;t.lineTo(i.x+r.dx*s,i.y+r.dy*s),t.stroke();var h=Math.atan((n.y-i.y)/(n.x-i.x));h+=(i.x<=n.x?90:-90)*Math.PI/180,t.save(),t.beginPath(),t.translate(n.x,n.y),t.rotate(h),t.moveTo(0,0),t.lineTo(3*_lineWidth,a),t.lineTo(-3*_lineWidth,a),t.closePath(),t.restore(),t.fill()},hitTest:t.LINE.hitTest,scaleGeometry:t.LINE.scaleGeometry,hint:function(t){return t?"Click to draw the point of your arrow.":"Click to draw the end of a new arrow."}}}},{key:"CIRCLE",get:function(){return{name:"circle",keyCode:67,startGeometry:function(t){return{center:{x:t.x,y:t.y},radius:0}},updateGeometry:function(e,i){var n=e.center;return e.radius=t._distance(i,n),e},boundingRect:function(t){var e=t.center.x-t.radius,i=t.center.x+t.radius,n=t.center.y-t.radius;return{x:e,y:n,width:i-e,height:t.center.y+t.radius-n}},drawInContext:function(t,e){var i=e;t.beginPath(),t.arc(i.center.x,i.center.y,i.radius,0,2*Math.PI),t.stroke()},hitTest:function(e,i){var n=t._distance(i,e.center);return Math.abs(n-e.radius)<_hitMargin},scaleGeometry:function(t,e){var i=t.center,n=t.radius;return{center:{x:i.x*e,y:i.y*e},radius:n*e}},dimensions:function(t){var e=t.radius;return[{key:"area",value:Math.PI*Math.pow(e,2)},{key:"radius",value:e},{key:"diameter",value:2*e}]},hint:function(t){return t?"Click to specificy the radius.":"Click where the center of a new circle should be."}}}},{key:"RECTANGLE",get:function(){return{name:"rectangle",keyCode:82,startGeometry:function(t){return{x:t.x,y:t.y,width:0,height:0}},updateGeometry:function(t,e){return t.width=e.x-t.x,t.height=e.y-t.y,t},finalGeometry:function(t){return{x:Math.min(t.x,t.x+t.width),y:Math.min(t.y,t.y+t.height),width:Math.abs(t.width),height:Math.abs(t.height)}},boundingRect:function(t){return t},drawInContext:function(t,e){var i=e;t.beginPath(),t.strokeRect(i.x,i.y,i.width,i.height),t.stroke()},hitTest:function(t,e){var i=[e.x>t.x-_hitMargin,e.x<t.x+t.width+_hitMargin,e.y>t.y-_hitMargin,e.y<t.y+t.height+_hitMargin],n=[Math.abs(t.x-e.x),Math.abs(t.x+t.width-e.x),Math.abs(t.y-e.y),Math.abs(t.y+t.height-e.y)];return i.every(function(t){return t})&&Math.min.apply(null,n)<_hitMargin},scaleGeometry:function(t,e){return{x:t.x*e,y:t.y*e,width:t.width*e,height:t.height*e}},dimensions:function(t){var e=t.width,i=t.height;return[{key:"area",value:e*i},{key:"width",value:e},{key:"height",value:i}]},hint:function(t){return t?"Click to draw the second corner.":"Click to draw the first corner of a new rectangle."}}}},{key:"FREEHAND",get:function(){return{name:"freehand",keyCode:70,startGeometry:function(t){return[[t.x,t.y]]},updateGeometry:function(t,e){var i=t.concat([[e.x,e.y]]);return i.length>10?(i=i.map(function(t){var e=_slicedToArray(t,2);return{x:e[0],y:e[1]}}),simplify(i,3,!0).map(function(t){return[t.x,t.y]})):i},boundingRect:function(t){var e=t.map(function(t){var e=_slicedToArray(t,2),i=e[0];e[1];return i}).sort(),i=t.map(function(t){var e=_slicedToArray(t,2);e[0];return e[1]}).sort(),n=e[0],a=e[e.length-1],r=i[0];return{x:n,y:r,width:a-n,height:i[i.length-1]-r}},drawInContext:function(t,e){t.save(),t.lineCap="round",t.beginPath();var i=e[0];t.beginPath(),t.moveTo(i[0],i[1]),e.forEach(function(e){var i=_slicedToArray(e,2),n=i[0],a=i[1];t.lineTo(n,a)}),t.stroke(),t.restore()},hitTest:function(e,i){return e.some(function(n,a){var r=_slicedToArray(n,2),o=r[0],s=r[1];if(e[a-1]){var h=_slicedToArray(e[a-1],2),l=h[0],c=h[1],u={p1:{x:o,y:s},p2:{x:l,y:c}};return t._onLine(u,i)}})},scaleGeometry:function(t,e){return t.map(function(t){var i=_slicedToArray(t,2),n=i[0],a=i[1];return[n*e,a*e]})},dimensions:function(t){t=t.concat([t[0]]);var e=t.reduce(function(e,i,n){var a=_slicedToArray(i,2),r=a[0],o=(a[1],t[n+1]);return o?e+r*o[1]:e},0),i=t.reduce(function(e,i,n){var a=_slicedToArray(i,2),r=(a[0],a[1]),o=t[n+1];return o?e+r*o[0]:e},0);return[{key:"area",value:Math.abs((i-e)/2)}]},hint:function(t){return t?"Click to stop drawing.":"Click to start drawing."}}}},{key:"POLYGON",get:function(){return{name:"polygon",keyCode:80,startGeometry:function(t){return[[t.x,t.y]]},updateGeometry:function(t,e){return 1===t.length?t.concat([[e.x,e.y]]):t.slice(0,-1).concat([[e.x,e.y]])},shouldAddSegment:function(t,e,i){return!i.shiftKey},addSegment:function(t,e){return t.concat([[e.x,e.y]])},boundingRect:t.FREEHAND.boundingRect,drawInContext:t.FREEHAND.drawInContext,hitTest:t.FREEHAND.hitTest,scaleGeometry:t.FREEHAND.scaleGeometry,dimensions:t.FREEHAND.dimensions,hint:function(t){return t?"Click to draw another point or shift + click to draw the last point.":"Click to draw the first point."}}}}]),t}();